(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{127:function(e,t){},153:function(e,t,a){},154:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(23),l=a.n(c),o=a(14),u=a.n(o),s=a(21),i=a(6);function m(e,t){var a="whatsapp-clone-"+e,r=Object(n.useState)((function(){var e=localStorage.getItem(a);return null!=e?JSON.parse(e):"function"===typeof t?t():t})),c=Object(i.a)(r,2),l=c[0],o=c[1];return Object(n.useEffect)((function(){localStorage.setItem(a,JSON.stringify(l))}),[a,l]),[l,o]}var d=a(162),f=a(161),p=a(156),v=a(159),E=a(163),b=a(26),g=a(24),h=r.a.createContext();function O(){return Object(n.useContext)(h)}function x(e){var t=e.children,a=m("contacts",[]),n=Object(i.a)(a,2),c=n[0],l=n[1];return r.a.createElement(h.Provider,{value:{contacts:c,createContact:function(e,t){l((function(a){return[].concat(Object(g.a)(a),[{id:e,name:t}])}))}}},t)}var j=a(84),C=a.n(j),y=r.a.createContext();function S(e){var t=e.id,a=e.children,c=Object(n.useState)(),l=Object(i.a)(c,2),o=l[0],u=l[1];return Object(n.useEffect)((function(){var e=C()("".concat(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_USERAPI),{query:{id:t}});return u(e),function(){return e.close()}}),[t]),r.a.createElement(y.Provider,{value:o},a)}var w=r.a.createContext();function N(){return Object(n.useContext)(w)}function k(e){var t=e.id,a=e.children,c=m("conversations",[]),l=Object(i.a)(c,2),o=l[0],u=l[1],s=Object(n.useState)(0),d=Object(i.a)(s,2),f=d[0],p=d[1],v=O().contacts,E=Object(n.useContext)(y);var h=Object(n.useCallback)((function(e){var t=e.recipients,a=e.text,n=e.sender;u((function(e){var r=!1,c={sender:n,text:a},l=e.map((function(e){return a=e.recipients,n=t,a.length===n.length&&(a.sort(),n.sort(),a.every((function(e,t){return e===n[t]})))?(r=!0,Object(b.a)(Object(b.a)({},e),{},{messages:[].concat(Object(g.a)(e.messages),[c])})):e;var a,n}));return r?l:[].concat(Object(g.a)(e),[{recipients:t,messages:[c]}])}))}),[u]);Object(n.useEffect)((function(){if(null!=E)return E.on("receive-message",h),function(){return E.off("receive-message")}}),[E,h]);var x=o.map((function(e,a){var n=e.recipients.map((function(e){var t=v.find((function(t){return t.id===e})),a=t&&t.name||e;return{id:e,name:a}})),r=e.messages.map((function(e){var a=v.find((function(t){return t.id===e.sender})),n=a&&a.name||e.sender,r=t===e.sender;return Object(b.a)(Object(b.a)({},e),{},{senderName:n,fromMe:r})})),c=a===f;return Object(b.a)(Object(b.a)({},e),{},{messages:r,recipients:n,selected:c})})),j={conversations:x,selectedConversation:x[f],sendMessage:function(e,a){E.emit("send-message",{recipients:e,text:a}),h({recipients:e,text:a,sender:t})},selectConversationIndex:p,createConversation:function(e){u((function(t){return[].concat(Object(g.a)(t),[{recipients:e,messages:[]}])}))}};return r.a.createElement(w.Provider,{value:j},a)}function L(){var e=N(),t=e.conversations,a=e.selectConversationIndex;return r.a.createElement(E.a,{variant:"flush"},t.map((function(e,t){return r.a.createElement(E.a.Item,{key:t,action:!0,onClick:function(){return a(t)},active:e.selected},e.recipients.map((function(e){return e.name})).join(", "))})))}function I(){var e=O().contacts;return r.a.createElement(E.a,{variant:"flush"},e.map((function(e){return r.a.createElement(E.a.Item,{key:e.id},e.name)})))}var P=a(160);function M(e){var t=e.closeModal,a=Object(n.useRef)(),c=Object(n.useRef)(),l=O().createContact;return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a.Header,{closeButton:!0},"Create Contact"),r.a.createElement(v.a.Body,null,r.a.createElement(P.a,{onSubmit:function(e){e.preventDefault(),l(a.current.value,c.current.value),t()}},r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Id"),r.a.createElement(P.a.Control,{type:"text",ref:a,required:!0})),r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Name"),r.a.createElement(P.a.Control,{type:"text",ref:c,required:!0})),r.a.createElement(p.a,{type:"submit"},"Create"))))}function _(e){var t=e.closeModal,a=Object(n.useState)([]),c=Object(i.a)(a,2),l=c[0],o=c[1],u=O().contacts,s=N().createConversation;return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a.Header,{closeButton:!0},"Create Conversation"),r.a.createElement(v.a.Body,null,r.a.createElement(P.a,{onSubmit:function(e){e.preventDefault(),s(l),t()}},u.map((function(e){return r.a.createElement(P.a.Group,{controlId:e.id,key:e.id},r.a.createElement(P.a.Check,{type:"checkbox",value:l.includes(e.id),label:e.name,onChange:function(){return t=e.id,void o((function(e){return e.includes(t)?e.filter((function(e){return t!==e})):[].concat(Object(g.a)(e),[t])}));var t}}))})),r.a.createElement(p.a,{type:"submit"},"Create"))))}function q(e){var t=e.id,a=Object(n.useState)("conversations"),c=Object(i.a)(a,2),l=c[0],o=c[1],u=Object(n.useState)(!1),s=Object(i.a)(u,2),m=s[0],E=s[1],b="conversations"===l;function g(){E(!1)}return r.a.createElement("div",{style:{width:"250px"},className:"d-flex flex-column"},r.a.createElement(d.a.Container,{activeKey:l,onSelect:o},r.a.createElement(f.a,{variant:"tabs",className:"justify-content-center"},r.a.createElement(f.a.Item,null,r.a.createElement(f.a.Link,{eventKey:"conversations"},"Conversations")),r.a.createElement(f.a.Item,null,r.a.createElement(f.a.Link,{eventKey:"contacts"},"Contacts"))),r.a.createElement(d.a.Content,{className:"border-right overflow-auto flex-grow-1"},r.a.createElement(d.a.Pane,{eventKey:"conversations"},r.a.createElement(L,null)),r.a.createElement(d.a.Pane,{eventKey:"contacts"},r.a.createElement(I,null))),r.a.createElement("div",{className:"p-2 border-top border-right small"},"Your Id: ",r.a.createElement("span",{className:"text-muted"},t)),r.a.createElement(p.a,{onClick:function(){return E(!0)},className:"rounded-0"},"New ",b?"Conversation":"Contact")),r.a.createElement(v.a,{show:m,onHide:g},b?r.a.createElement(_,{closeModal:g}):r.a.createElement(M,{closeModal:g})))}var G=a(157);function D(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),a=t[0],c=t[1],l=Object(n.useCallback)((function(e){e&&e.scrollIntoView({smooth:!0})}),[]),o=N(),u=o.sendMessage,s=o.selectedConversation;function m(e){e.preventDefault(),u(s.recipients.map((function(e){return e.id})),a),c("")}return r.a.createElement("div",{className:"d-flex flex-column flex-grow-1"},r.a.createElement("div",{className:"flex-grow-1 overflow-auto"},r.a.createElement("div",{className:"d-flex flex-column align-items-start justify-content-end px-3"},s.messages.map((function(e,t){var a=s.messages.length-1===t;return r.a.createElement("div",{ref:a?l:null,key:t,className:"my-1 d-flex flex-column ".concat(e.fromMe?"align-self-end align-items-end":"align-items-start")},r.a.createElement("div",{className:"rounded px-2 py-1 ".concat(e.fromMe?"bg-primary text-white":"border")},e.text),r.a.createElement("div",{className:"text-muted small ".concat(e.fromMe?"text-right":"")},e.fromMe?"You":e.senderName))})))),r.a.createElement(P.a,{onSubmit:m},r.a.createElement(P.a.Group,{className:"m-2"},r.a.createElement(G.a,null,r.a.createElement(P.a.Control,{as:"textarea",required:!0,value:a,onChange:function(e){return c(e.target.value)},onKeyPress:function(e){return"Enter"===e.key&&m(e)},style:{height:"75px",resize:"none"}}),r.a.createElement(G.a.Append,null,r.a.createElement(p.a,{type:"submit"},"Send"))))))}var K=a(28),T=a.n(K),V=a(7);function R(e){var t=e.id,a=Object(V.f)(),n=N().selectedConversation,c=function(){var e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.a.get("/logout");case 2:a.push("/");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t||a.push("/"),r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}},r.a.createElement(p.a,{onClick:c},"Logout"),r.a.createElement("div",{className:"d-flex",style:{height:"80vh",maxHeight:"800px",margin:"100px",width:"1000px",maxWidth:"1200px",backgroundColor:"white",borderRadius:"5px"}},r.a.createElement(q,{id:t}),n&&r.a.createElement(D,null)))}var B=a(158);function H(e){var t=e.onLoginSuccess,a=Object(V.f)(),c=Object(n.useState)({username:"",fullName:"",_id:0,succes:!1,error:!1}),l=Object(i.a)(c,2),o=l[0],m=l[1];Object(n.useEffect)((function(){console.log("useEffect",o),o.success&&t(!0)}),[o]);return r.a.createElement(B.a,{className:"align-items-center d-flex",style:{height:"100vh"}},r.a.createElement(P.a,{onSubmit:function(e){console.log("handleSubmit"),e.preventDefault();var t={username:e.target[0].value,password:e.target[1].value};(function(){var e=Object(s.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLogin",t,JSON.stringify(t)),n={method:"POST",url:"/loginapi",data:t},e.next=4,T()(n);case 4:r=e.sent,console.log("response",r.status,r.data),r&&r.data&&r.data.success&&m(r.data),a.push("/dashboard");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}})()(t)},className:"w-100"},r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Username"),r.a.createElement(P.a.Control,{placeholder:"username",name:"username",defaultValue:"",required:!0})),r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Password"),r.a.createElement(P.a.Control,{type:"password",placeholder:"password",name:"password",defaultValue:"",required:!0})),r.a.createElement(p.a,{type:"submit",className:"mr-2"},"Login")))}var A=a(32);var J=function(){var e=Object(V.f)(),t=function(){var t=Object(s.a)(u.a.mark((function t(a){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleSubmit"),a.preventDefault(),n={username:a.target[0].value,password:a.target[1].value,fullName:a.target[2].value,email:a.target[3].value},t.next=5,T.a.post("/signup",n);case 5:r=t.sent,console.log(r),e.push("/login");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement(B.a,{className:"align-items-center d-flex",style:{height:"100vh"}},r.a.createElement(P.a,{onSubmit:t,className:"w-100"},r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Username"),r.a.createElement(P.a.Control,{placeholder:"username",name:"username",defaultValue:"",required:!0})),r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Password"),r.a.createElement(P.a.Control,{type:"password",placeholder:"password",name:"password",defaultValue:"",required:!0})),r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Full Name"),r.a.createElement(P.a.Control,{type:"text",placeholder:"Full Name",name:"fullName",defaultValue:"",required:!0})),r.a.createElement(P.a.Group,null,r.a.createElement(P.a.Label,null,"Email"),r.a.createElement(P.a.Control,{type:"email",placeholder:"email",name:"email",defaultValue:"",required:!0})),r.a.createElement(p.a,{type:"submit",className:"mr-2"},"Signup")))};var U=function(){var e=Object(n.useState)("id"),t=Object(i.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(!0),o=Object(i.a)(l,2),m=o[0],d=o[1],f=Object(n.useState)({}),p=Object(i.a)(f,2),v=(p[0],p[1]),E=Object(n.useState)(!1),b=Object(i.a)(E,2),g=b[0],h=b[1];return Object(n.useEffect)((function(){console.log("Container useEffect"),function(){var e=Object(s.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/auth/user");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,v(a),c(a._id),d(!1),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}()()}),[g]),m?r.a.createElement("div",null,"Loading ..."):r.a.createElement(A.a,null,r.a.createElement(V.c,null,r.a.createElement(V.a,{exact:!0,path:"/dashboard"},r.a.createElement(S,{id:a},r.a.createElement(x,null,r.a.createElement(k,{id:a},r.a.createElement(R,{id:a}))))),r.a.createElement(V.a,{exact:!0,path:"/",component:J}),r.a.createElement(V.a,{exact:!0,path:"/signup",component:J}),r.a.createElement(V.a,{exact:!0,path:"/login"},r.a.createElement(H,{onLoginSuccess:h}))))};a(152),a(153);l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root"))},92:function(e,t,a){e.exports=a(154)}},[[92,1,2]]]);
//# sourceMappingURL=main.ef8e5d4a.chunk.js.map